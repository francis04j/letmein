@model EncryptedItemViewModel
@{
	ViewData["Title"] = "Load";
}

@if (Model == null)
{
	<p>
		@ViewData.ModelState.First().Value
	</p>
}
else
{
	<p>
		Enter the password you created to decrypt the text.
	</p>

	<form id="decrypt-form">
		<input type="hidden" id="cipherJson" value="@Model.CipherJson" />
		<textarea id="cipher-textarea" rows="10" placeholder="The decrypted text will appear here" readonly></textarea>

		<div class="row">
			<div class="col-md-10">
				<input name="password" id="password-input" class="password" type="password" placeholder="Enter your password" />
			</div>
			<div class="col-md-2">
				<input type="button" id="decrypt-button" class="btn btn-success" value="Decrypt" />
			</div>
		</div>
	</form>

	@section scripts
	{
		<script>
			$(document).ready(function () {
				$("#decrypt-form").submit(function () {
					return false;
				});

				$("#decrypt-button").click(function () {
					var cipherJson = $("#cipherJson").val();
					var password = $("#password-input").val();

					try {
						var text = window.sjcl.decrypt(password, cipherJson);
						$("#cipher-textarea").val(text);
					}
					catch (err) {
						alert("decryption failed");
					}
				});
			});
		</script>
	}
}